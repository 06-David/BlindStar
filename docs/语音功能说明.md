# BlindStar 语音导航功能说明

## 功能概述

BlindStar 现已集成语音导航功能，支持通过语音命令进行POI查询和导航操作。该功能基于高德地图API，提供准确的位置信息和路径规划服务。

## 主要功能

### 1. POI查询功能
- **语音查询**: 支持"附近有什么餐厅"、"查找咖啡厅"等自然语言查询
- **拼音匹配**: 支持拼音输入，提高语音识别准确性
- **多类型支持**: 支持餐厅、咖啡厅、超市、银行、医院、地铁站等多种POI类型
- **距离排序**: 自动按距离远近排序，优先显示最近的地点

### 2. 语音导航功能
- **目的地设置**: "导航到天安门"、"去北京大学"等
- **路径规划**: 自动规划最优路径，支持步行和公交模式
- **实时导航**: 提供转向提示和距离播报
- **导航控制**: 支持开始、暂停、继续、结束导航等操作

## 支持的语音命令

### POI查询命令
- "附近有什么餐厅"
- "查找咖啡厅"
- "附近的超市"
- "找银行"

### 导航命令
- **设置目的地**:
  - "导航到[地点名称]"
  - "去[地点名称]"
  - "导航去[地点名称]"

- **导航控制**:
  - "开始导航"
  - "结束导航"
  - "暂停导航"
  - "继续导航"
  - "重新规划"

- **信息查询**:
  - "当前位置"
  - "剩余距离"
  - "下一个路口"

## 配置说明

### 高德地图API配置
在 `config.py` 中的 `AmapConfig` 类中配置：

```python
class AmapConfig:
    # API密钥（请替换为您自己的密钥）
    API_KEY = "your_amap_api_key_here"
    
    # 默认搜索半径（米）
    DEFAULT_RADIUS = 1000
    
    # 导航更新间隔（秒）
    NAVIGATION_UPDATE_INTERVAL = 5
```

### 环境准备
首先激活conda环境，然后安装依赖：

```bash
conda activate yolov8
pip install pypinyin regex requests geopy vosk pyttsx3
```

## 使用方法

### 1. 启动带语音功能的系统
```bash
python main.py --source 0 --module vision voice poi navigation
```

### 2. 仅启动POI查询功能
```bash
python main.py --source 0 --module vision voice poi
```

### 3. 禁用语音功能
```bash
python main.py --source 0 --disable-voice
```

## 测试功能

运行测试脚本验证功能：

```bash
python tests/test_navigation.py
```

## 支持的POI类型

### 餐饮服务
- 餐厅、餐馆、饭店、中餐厅
- 咖啡厅、咖啡馆、茶馆、酒吧
- 快餐、肯德基、麦当劳、必胜客

### 购物服务
- 超市、便利店、商场、购物中心
- 市场、菜市场、专卖店、药店

### 生活服务
- 银行、ATM、医院、诊所
- 邮局、洗衣店、美容美发、维修

### 交通设施
- 地铁、地铁站、公交、公交站
- 火车站、机场、停车场

### 休闲娱乐
- 公园、景区、博物馆、图书馆
- 电影院、KTV、健身房、体育馆

### 其他
- 酒店、宾馆、厕所

## 注意事项

1. **API密钥**: 需要申请高德地图API密钥并在配置文件中设置
2. **网络连接**: POI查询和导航功能需要网络连接
3. **语音识别**: 建议在安静环境中使用，提高语音识别准确性
4. **GPS定位**: 实际使用中需要集成GPS模块获取准确位置
5. **权限设置**: 确保应用有麦克风和扬声器访问权限

## 故障排除

### 常见问题
1. **语音识别不准确**: 检查麦克风设置，确保环境安静
2. **POI查询失败**: 检查网络连接和API密钥配置
3. **导航无响应**: 确保已设置目的地且网络连接正常
4. **TTS无声音**: 检查系统音量和扬声器设置

### 日志查看
系统会在控制台输出详细日志，可以通过日志信息诊断问题：

```bash
# 启用详细日志
python main.py --source 0 --module vision voice poi navigation --verbose
```

## 扩展开发

### 添加新的POI类型
在 `config.py` 的 `AmapConfig.POI_TYPES` 中添加新的映射：

```python
POI_TYPES = {
    # 现有类型...
    "新类型": "对应的高德POI代码"
}
```

### 自定义语音命令
在 `core/amap_navigation.py` 的 `VoiceNavigationHandler.NAVIGATION_COMMANDS` 中添加新命令：

```python
NAVIGATION_COMMANDS = {
    # 现有命令...
    "新命令": "对应的处理函数名"
}
```

## 更新日志

- **v1.0**: 基础POI查询功能
- **v1.1**: 添加语音导航功能
- **v1.2**: 增强语音命令识别，支持拼音匹配
- **v1.3**: 优化导航体验，添加更多语音提示
