# BlindStar ç³»ç»Ÿé›†æˆæ¨¡å—æ–‡æ¡£

## ğŸ“– æ¨¡å—æ¦‚è¿°

BlindStarç³»ç»Ÿé›†æˆæ¨¡å—æ˜¯æ•´ä¸ªæ™ºèƒ½è§†è§‰è¾…åŠ©ç³»ç»Ÿçš„æ ¸å¿ƒåè°ƒå™¨ï¼Œè´Ÿè´£ç»Ÿä¸€ç®¡ç†å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œæä¾›å®Œæ•´çš„ç³»ç»Ÿå¯åŠ¨ã€é…ç½®ç®¡ç†ã€æ¨¡å—é—´é€šä¿¡å’ŒçŠ¶æ€ç›‘æ§åŠŸèƒ½ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶
- **ä¸»ç³»ç»Ÿ** (`core/blindstar.py`): ç³»ç»Ÿæ ¸å¿ƒåè°ƒå™¨
- **å¯åŠ¨å™¨** (`realtime_launcher.py`): ç»Ÿä¸€å¯åŠ¨å…¥å£
- **é…ç½®ç®¡ç†** (`config.py`): å…¨å±€é…ç½®ç®¡ç†
- **å·¥å…·é›†** (`core/utils.py`): é€šç”¨å·¥å…·å‡½æ•°
- **ç³»ç»Ÿåˆå§‹åŒ–** (`core/__init__.py`): æ¨¡å—åˆå§‹åŒ–ç®¡ç†

### ç³»ç»Ÿæ¶æ„å±‚æ¬¡
```
åº”ç”¨å…¥å£å±‚
â”œâ”€â”€ main.py (ä¸»CLIåº”ç”¨)
â”œâ”€â”€ realtime_launcher.py (å®æ—¶å¯åŠ¨å™¨)
â””â”€â”€ batch_process.py (æ‰¹é‡å¤„ç†)

æ ¸å¿ƒåŠŸèƒ½å±‚ (core/)
â”œâ”€â”€ blindstar.py (ç³»ç»Ÿæ ¸å¿ƒ)
â”œâ”€â”€ detector.py (ç‰©ä½“æ£€æµ‹)
â”œâ”€â”€ distance.py (æ·±åº¦ä¼°è®¡)
â”œâ”€â”€ tts_engine.py (è¯­éŸ³åˆæˆ)
â”œâ”€â”€ stt_engine.py (è¯­éŸ³è¯†åˆ«)
â”œâ”€â”€ amap_navigation.py (å¯¼èˆªæœåŠ¡)
â””â”€â”€ å…¶ä»–åŠŸèƒ½æ¨¡å—...

é…ç½®ç®¡ç†å±‚
â”œâ”€â”€ config.py (é…ç½®ç®¡ç†)
â””â”€â”€ å„æ¨¡å—é…ç½®æ–‡ä»¶

å·¥å…·æ”¯æŒå±‚
â”œâ”€â”€ utils.py (å·¥å…·å‡½æ•°)
â””â”€â”€ tests/ (æµ‹è¯•è„šæœ¬)
```

## ğŸ¯ ç³»ç»Ÿæ ¸å¿ƒ (BlindStar)

### BlindStarç±»
ç³»ç»Ÿçš„æ ¸å¿ƒåè°ƒå™¨ï¼Œç®¡ç†æ‰€æœ‰åŠŸèƒ½æ¨¡å—ï¼š

```python
class BlindStar:
    def __init__(self, config_path="config.py"):
        self.config = self.load_config(config_path)
        self.detector = None
        self.distance_calculator = None
        self.tts_engine = None
        self.stt_engine = None
        self.navigation = None
        self.camera = None
        self.is_running = False
        self.modules_status = {}
```

### ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹
```python
def initialize_system(self):
    """ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹"""
    try:
        # 1. åŠ è½½é…ç½®
        self.load_configuration()
        
        # 2. åˆå§‹åŒ–æ ¸å¿ƒæ¨¡å—
        self.init_detector()
        self.init_depth_estimation()
        self.init_voice_engines()
        
        # 3. åˆå§‹åŒ–æ‰©å±•æ¨¡å—
        self.init_navigation()
        self.init_camera()
        
        # 4. å»ºç«‹æ¨¡å—é—´è¿æ¥
        self.setup_module_connections()
        
        # 5. ç³»ç»Ÿè‡ªæ£€
        self.run_system_check()
        
        self.is_running = True
        return True
        
    except Exception as e:
        self.handle_initialization_error(e)
        return False
```

### æ¨¡å—ç®¡ç†
```python
def init_detector(self):
    """åˆå§‹åŒ–æ£€æµ‹æ¨¡å—"""
    from core.detector import Detector
    
    model_path = self.config.DETECTION_CONFIG['model_path']
    device = self.config.DETECTION_CONFIG['device']
    
    self.detector = Detector(model_path=model_path, device=device)
    self.modules_status['detector'] = 'initialized'
    
def init_depth_estimation(self):
    """åˆå§‹åŒ–æ·±åº¦ä¼°è®¡æ¨¡å—"""
    from core.distance import DistanceCalculator
    
    model_type = self.config.DEPTH_CONFIG['model_type']
    self.distance_calculator = DistanceCalculator(model_type=model_type)
    self.modules_status['depth'] = 'initialized'
    
def init_voice_engines(self):
    """åˆå§‹åŒ–è¯­éŸ³å¼•æ“"""
    from core.tts_engine import TTSEngine
    from core.stt_engine import STTEngine
    
    self.tts_engine = TTSEngine()
    self.stt_engine = STTEngine()
    self.modules_status['voice'] = 'initialized'
```

## ğŸš€ å¯åŠ¨å™¨ç³»ç»Ÿ

### RealtimeLauncherç±»
ç»Ÿä¸€çš„ç³»ç»Ÿå¯åŠ¨å…¥å£ï¼Œæ”¯æŒå¤šç§å¯åŠ¨æ¨¡å¼ï¼š

```python
class RealtimeLauncher:
    def __init__(self):
        self.blindstar = None
        self.launch_mode = "full"
        self.enabled_modules = []
        self.startup_params = {}
        
    def launch_system(self, mode="full", **kwargs):
        """å¯åŠ¨ç³»ç»Ÿ"""
        self.launch_mode = mode
        self.startup_params = kwargs
        
        # æ ¹æ®æ¨¡å¼é…ç½®å¯ç”¨çš„æ¨¡å—
        self.configure_modules_by_mode(mode)
        
        # åˆå§‹åŒ–BlindStarç³»ç»Ÿ
        self.blindstar = BlindStar()
        
        # é€‰æ‹©æ€§åˆå§‹åŒ–æ¨¡å—
        self.selective_module_init()
        
        # å¯åŠ¨ä¸»å¾ªç¯
        self.start_main_loop()
```

### å¯åŠ¨æ¨¡å¼
```python
LAUNCH_MODES = {
    'full': {
        'description': 'å®Œæ•´åŠŸèƒ½æ¨¡å¼',
        'modules': ['detector', 'depth', 'voice', 'navigation', 'camera'],
        'features': ['å®æ—¶æ£€æµ‹', 'æ·±åº¦ä¼°è®¡', 'è¯­éŸ³äº¤äº’', 'å¯¼èˆªæœåŠ¡']
    },
    'detection_only': {
        'description': 'ä»…æ£€æµ‹æ¨¡å¼',
        'modules': ['detector', 'camera'],
        'features': ['ç‰©ä½“æ£€æµ‹', 'åŸºç¡€è§†è§‰']
    },
    'voice_navigation': {
        'description': 'è¯­éŸ³å¯¼èˆªæ¨¡å¼',
        'modules': ['voice', 'navigation'],
        'features': ['è¯­éŸ³äº¤äº’', 'POIæŸ¥è¯¢', 'å¯¼èˆªæœåŠ¡']
    },
    'offline': {
        'description': 'ç¦»çº¿æ¨¡å¼',
        'modules': ['detector', 'depth', 'voice', 'camera'],
        'features': ['ç¦»çº¿æ£€æµ‹', 'æœ¬åœ°è¯­éŸ³', 'æ·±åº¦ä¼°è®¡']
    }
}
```

### å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ
```python
def parse_launch_arguments():
    """è§£æå¯åŠ¨å‚æ•°"""
    parser = argparse.ArgumentParser(description='BlindStarå¯åŠ¨å™¨')
    
    parser.add_argument('--mode', choices=['full', 'detection_only', 'voice_navigation', 'offline'],
                       default='full', help='å¯åŠ¨æ¨¡å¼')
    parser.add_argument('--source', type=str, default='0', help='è§†é¢‘æº')
    parser.add_argument('--model', type=str, help='æ£€æµ‹æ¨¡å‹è·¯å¾„')
    parser.add_argument('--device', type=str, default='auto', help='è®¡ç®—è®¾å¤‡')
    parser.add_argument('--resolution', type=str, default='640x480', help='è§†é¢‘åˆ†è¾¨ç‡')
    parser.add_argument('--fps', type=int, default=30, help='ç›®æ ‡å¸§ç‡')
    parser.add_argument('--confidence', type=float, default=0.5, help='æ£€æµ‹ç½®ä¿¡åº¦')
    parser.add_argument('--enable-recording', action='store_true', help='å¯ç”¨å½•åˆ¶')
    parser.add_argument('--output-dir', type=str, default='output', help='è¾“å‡ºç›®å½•')
    parser.add_argument('--config', type=str, help='é…ç½®æ–‡ä»¶è·¯å¾„')
    parser.add_argument('--verbose', action='store_true', help='è¯¦ç»†è¾“å‡º')
    
    return parser.parse_args()
```

## âš™ï¸ é…ç½®ç®¡ç†ç³»ç»Ÿ

### å…¨å±€é…ç½®ç»“æ„
```python
class BlindStarConfig:
    """BlindStarå…¨å±€é…ç½®"""
    
    # ç³»ç»Ÿé…ç½®
    SYSTEM_CONFIG = {
        'version': '1.3.0',
        'debug_mode': False,
        'log_level': 'INFO',
        'max_threads': 4,
        'memory_limit': 2048,  # MB
        'gpu_memory_fraction': 0.8
    }
    
    # æ£€æµ‹é…ç½®
    DETECTION_CONFIG = {
        'model_path': 'models/yolo11s.pt',
        'device': 'cuda:0',
        'confidence_threshold': 0.5,
        'iou_threshold': 0.45,
        'max_detections': 100,
        'input_size': 640
    }
    
    # æ·±åº¦ä¼°è®¡é…ç½®
    DEPTH_CONFIG = {
        'model_type': 'zoedepth',
        'fallback_model': 'midas',
        'max_depth': 100.0,
        'min_depth': 0.1,
        'calibration_factor': 1.0
    }
    
    # è¯­éŸ³é…ç½®
    VOICE_CONFIG = {
        'tts_engine': 'sapi_pyttsx3',
        'stt_engine': 'vosk',
        'voice_rate': 200,
        'voice_volume': 0.8,
        'enable_voice_commands': True
    }
    
    # å¯¼èˆªé…ç½®
    NAVIGATION_CONFIG = {
        'amap_api_key': '',
        'default_mode': 'walking',
        'poi_search_radius': 1000,
        'enable_offline_maps': False
    }
```

### åŠ¨æ€é…ç½®åŠ è½½
```python
class ConfigManager:
    def __init__(self, config_path="config.py"):
        self.config_path = config_path
        self.config = None
        self.watchers = []
        
    def load_config(self):
        """åŠ è½½é…ç½®æ–‡ä»¶"""
        try:
            spec = importlib.util.spec_from_file_location("config", self.config_path)
            config_module = importlib.util.module_from_spec(spec)
            spec.loader.exec_module(config_module)
            self.config = config_module
            return True
        except Exception as e:
            print(f"é…ç½®åŠ è½½å¤±è´¥: {e}")
            return False
    
    def reload_config(self):
        """é‡æ–°åŠ è½½é…ç½®"""
        return self.load_config()
    
    def get_module_config(self, module_name):
        """è·å–æ¨¡å—é…ç½®"""
        config_name = f"{module_name.upper()}_CONFIG"
        return getattr(self.config, config_name, {})
```

## ğŸ”— æ¨¡å—é—´é€šä¿¡

### äº‹ä»¶ç³»ç»Ÿ
```python
class EventBus:
    def __init__(self):
        self.subscribers = {}
        self.event_queue = queue.Queue()
        
    def subscribe(self, event_type, callback):
        """è®¢é˜…äº‹ä»¶"""
        if event_type not in self.subscribers:
            self.subscribers[event_type] = []
        self.subscribers[event_type].append(callback)
    
    def publish(self, event_type, data=None):
        """å‘å¸ƒäº‹ä»¶"""
        event = {
            'type': event_type,
            'data': data,
            'timestamp': time.time()
        }
        self.event_queue.put(event)
    
    def process_events(self):
        """å¤„ç†äº‹ä»¶é˜Ÿåˆ—"""
        while not self.event_queue.empty():
            try:
                event = self.event_queue.get_nowait()
                self.dispatch_event(event)
            except queue.Empty:
                break
```

### æ•°æ®æµç®¡é“
```python
class DataPipeline:
    def __init__(self):
        self.stages = []
        self.data_cache = {}
        
    def add_stage(self, stage_name, processor):
        """æ·»åŠ å¤„ç†é˜¶æ®µ"""
        self.stages.append({
            'name': stage_name,
            'processor': processor,
            'enabled': True
        })
    
    def process_data(self, input_data):
        """å¤„ç†æ•°æ®æµ"""
        current_data = input_data
        
        for stage in self.stages:
            if stage['enabled']:
                try:
                    current_data = stage['processor'](current_data)
                    self.data_cache[stage['name']] = current_data
                except Exception as e:
                    print(f"é˜¶æ®µ {stage['name']} å¤„ç†å¤±è´¥: {e}")
                    break
        
        return current_data
```

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### æ€§èƒ½ç›‘æ§å™¨
```python
class PerformanceMonitor:
    def __init__(self):
        self.metrics = {}
        self.start_time = time.time()
        self.frame_times = []
        
    def record_frame_time(self, processing_time):
        """è®°å½•å¸§å¤„ç†æ—¶é—´"""
        self.frame_times.append(processing_time)
        if len(self.frame_times) > 100:  # ä¿æŒæœ€è¿‘100å¸§
            self.frame_times.pop(0)
    
    def get_fps(self):
        """è·å–å½“å‰FPS"""
        if len(self.frame_times) < 2:
            return 0
        avg_time = sum(self.frame_times) / len(self.frame_times)
        return 1.0 / avg_time if avg_time > 0 else 0
    
    def get_system_stats(self):
        """è·å–ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯"""
        return {
            'fps': self.get_fps(),
            'avg_processing_time': sum(self.frame_times) / len(self.frame_times) if self.frame_times else 0,
            'uptime': time.time() - self.start_time,
            'total_frames': len(self.frame_times)
        }
```

### å¥åº·æ£€æŸ¥
```python
class HealthChecker:
    def __init__(self, blindstar_system):
        self.system = blindstar_system
        self.check_interval = 30  # 30ç§’æ£€æŸ¥ä¸€æ¬¡
        
    def run_health_check(self):
        """è¿è¡Œå¥åº·æ£€æŸ¥"""
        health_status = {
            'overall': 'healthy',
            'modules': {},
            'warnings': [],
            'errors': []
        }
        
        # æ£€æŸ¥å„æ¨¡å—çŠ¶æ€
        for module_name, module in self.system.get_modules().items():
            status = self.check_module_health(module_name, module)
            health_status['modules'][module_name] = status
            
            if status['status'] == 'error':
                health_status['overall'] = 'error'
                health_status['errors'].append(f"{module_name}: {status['message']}")
            elif status['status'] == 'warning':
                if health_status['overall'] == 'healthy':
                    health_status['overall'] = 'warning'
                health_status['warnings'].append(f"{module_name}: {status['message']}")
        
        return health_status
```

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç³»ç»Ÿå¯åŠ¨
```python
from core.blindstar import BlindStar

# åˆå§‹åŒ–ç³»ç»Ÿ
blindstar = BlindStar()

# å¯åŠ¨ç³»ç»Ÿ
if blindstar.initialize_system():
    print("ç³»ç»Ÿå¯åŠ¨æˆåŠŸ")
    
    # è¿è¡Œä¸»å¾ªç¯
    blindstar.run_main_loop()
else:
    print("ç³»ç»Ÿå¯åŠ¨å¤±è´¥")
```

### ä½¿ç”¨å¯åŠ¨å™¨
```bash
# å®Œæ•´åŠŸèƒ½å¯åŠ¨
python realtime_launcher.py --mode full --source 0

# ä»…æ£€æµ‹æ¨¡å¼
python realtime_launcher.py --mode detection_only --model yolo11s.pt

# è¯­éŸ³å¯¼èˆªæ¨¡å¼
python realtime_launcher.py --mode voice_navigation

# è‡ªå®šä¹‰å‚æ•°å¯åŠ¨
python realtime_launcher.py --mode full --resolution 1280x720 --fps 30 --confidence 0.6
```

### æ¨¡å—åŒ–é›†æˆ
```python
# é€‰æ‹©æ€§åˆå§‹åŒ–æ¨¡å—
blindstar = BlindStar()
blindstar.init_detector()
blindstar.init_voice_engines()

# è‡ªå®šä¹‰å¤„ç†æµç¨‹
def custom_processing_loop():
    while blindstar.is_running:
        # è·å–æ‘„åƒå¤´å¸§
        frame = blindstar.camera.read_frame()
        
        # ç‰©ä½“æ£€æµ‹
        detections = blindstar.detector.detect_objects(frame)
        
        # è¯­éŸ³æ’­æŠ¥
        if detections:
            message = f"æ£€æµ‹åˆ°{len(detections)}ä¸ªç‰©ä½“"
            blindstar.tts_engine.speak(message)
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç³»ç»Ÿå¯åŠ¨å¤±è´¥
```
åŸå› : æ¨¡å—ä¾èµ–ç¼ºå¤±æˆ–é…ç½®é”™è¯¯
è§£å†³:
- æ£€æŸ¥Pythonç¯å¢ƒå’Œä¾èµ–åŒ…
- éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
- æŸ¥çœ‹å¯åŠ¨æ—¥å¿—é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨--verboseå‚æ•°è·å–è¯¦ç»†ä¿¡æ¯
```

#### 2. æ¨¡å—åˆå§‹åŒ–å¤±è´¥
```
åŸå› : ç¡¬ä»¶ä¸æ”¯æŒæˆ–æƒé™é—®é¢˜
è§£å†³:
- æ£€æŸ¥GPUé©±åŠ¨å’ŒCUDAç‰ˆæœ¬
- éªŒè¯æ‘„åƒå¤´æƒé™
- ç¡®è®¤æ¨¡å‹æ–‡ä»¶å­˜åœ¨
- å°è¯•CPUæ¨¡å¼è¿è¡Œ
```

#### 3. æ€§èƒ½é—®é¢˜
```
åŸå› : ç¡¬ä»¶æ€§èƒ½ä¸è¶³æˆ–é…ç½®ä¸å½“
è§£å†³:
- é™ä½åˆ†è¾¨ç‡å’Œå¸§ç‡
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹
- è°ƒæ•´çº¿ç¨‹æ•°é‡
- å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç³»ç»Ÿæ€§èƒ½
- **å¯åŠ¨æ—¶é—´**: < 10ç§’ï¼ˆå®Œæ•´æ¨¡å¼ï¼‰
- **å†…å­˜å ç”¨**: < 2GBï¼ˆæ­£å¸¸è¿è¡Œï¼‰
- **CPUå ç”¨**: < 30%ï¼ˆå®æ—¶å¤„ç†ï¼‰
- **GPUå ç”¨**: < 80%ï¼ˆæ·±åº¦å­¦ä¹ æ¨ç†ï¼‰

### æ¨¡å—åè°ƒæ€§èƒ½
- **äº‹ä»¶å“åº”**: < 10ms
- **æ¨¡å—é—´é€šä¿¡**: < 5ms
- **é…ç½®é‡è½½**: < 1ç§’
- **å¥åº·æ£€æŸ¥**: < 100ms

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.3 (å½“å‰ç‰ˆæœ¬)
- âœ… å®ç°ç»Ÿä¸€å¯åŠ¨å™¨ç³»ç»Ÿ
- âœ… æ·»åŠ æ¨¡å—åŒ–é…ç½®ç®¡ç†
- âœ… é›†æˆç³»ç»Ÿç›‘æ§å’Œå¥åº·æ£€æŸ¥
- âœ… ä¼˜åŒ–æ¨¡å—é—´é€šä¿¡æœºåˆ¶

### v1.2
- âœ… åŸºç¡€ç³»ç»Ÿé›†æˆæ¡†æ¶
- âœ… ç®€å•çš„æ¨¡å—ç®¡ç†
- âœ… é…ç½®æ–‡ä»¶æ”¯æŒ

### v1.1
- âœ… æ ¸å¿ƒBlindStarç±»å®ç°
- âœ… åŸºæœ¬çš„ç³»ç»Ÿåˆå§‹åŒ–
- âœ… ç®€å•çš„é”™è¯¯å¤„ç†

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [è¯­éŸ³æ¨¡å—æ–‡æ¡£](./è¯­éŸ³æ¨¡å—.md)
- [å¯¼èˆªæ¨¡å—æ–‡æ¡£](./å¯¼èˆªæ¨¡å—.md)
- [æ£€æµ‹æ¨¡å—æ–‡æ¡£](./æ£€æµ‹æ¨¡å—.md)
- [æ·±åº¦ä¼°è®¡æ¨¡å—æ–‡æ¡£](./æ·±åº¦ä¼°è®¡æ¨¡å—.md)
- [ç›¸æœºæ¨¡å—æ–‡æ¡£](./ç›¸æœºæ¨¡å—.md)
- [é¿éšœæ¨¡å—æ–‡æ¡£](./é¿éšœæ¨¡å—.md)
