# BlindStar é¿éšœæ¨¡å—æ–‡æ¡£

## ğŸ“– æ¨¡å—æ¦‚è¿°

BlindStaré¿éšœæ¨¡å—æ˜¯ç³»ç»Ÿå®‰å…¨ä¿éšœçš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡æ•´åˆç‰©ä½“æ£€æµ‹ã€æ·±åº¦ä¼°è®¡ã€é£é™©è¯„ä¼°å’Œå†³ç­–å¼•æ“ï¼Œä¸ºè§†éšœç”¨æˆ·æä¾›æ™ºèƒ½é¿éšœå’Œè·¯å¾„è§„åˆ’èƒ½åŠ›ã€‚è¯¥æ¨¡å—å®ç°äº†å¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤æœºåˆ¶ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶
- **é£é™©è¯„ä¼°å™¨** (`core/risk_assessor.py`): å¤šç»´åº¦é£é™©åˆ†æå’Œè¯„ä¼°
- **å†³ç­–å¼•æ“** (`core/decision_engine.py`): æ™ºèƒ½å†³ç­–å’Œè¡ŒåŠ¨è§„åˆ’
- **è¡ŒåŠ¨è§„åˆ’å™¨** (`core/action_planner.py`): å…·ä½“é¿éšœè¡ŒåŠ¨ç”Ÿæˆ
- **ç‰©ä½“è¿½è¸ªå™¨** (`core/object_tracker.py`): åŠ¨æ€ç‰©ä½“è½¨è¿¹è·Ÿè¸ª
- **é€Ÿåº¦æµ‹é‡** (`core/speed_measurement.py`): ç‰©ä½“è¿åŠ¨é€Ÿåº¦è®¡ç®—

### æŠ€æœ¯æ¶æ„
- **å¤šä¼ æ„Ÿå™¨èåˆ**: è§†è§‰æ£€æµ‹ + æ·±åº¦ä¼°è®¡ + è¿åŠ¨åˆ†æ
- **åˆ†å±‚å†³ç­–**: L0-L3é£é™©ç­‰çº§åˆ†å±‚å¤„ç†
- **å®æ—¶å“åº”**: æ¯«ç§’çº§å±é™©å“åº”å’Œé¿éšœæŒ‡ä»¤
- **é¢„æµ‹æ€§é¿éšœ**: åŸºäºç‰©ä½“è¿åŠ¨è½¨è¿¹çš„é¢„æµ‹æ€§è§„é¿

## ğŸš¨ é£é™©è¯„ä¼°ç³»ç»Ÿ

### RiskAssessorç±»
å¤šç»´åº¦é£é™©åˆ†ææ ¸å¿ƒç»„ä»¶ï¼š

```python
class RiskAssessor:
    def __init__(self):
        self.risk_factors = {
            'distance': 0.4,      # è·ç¦»å› å­æƒé‡
            'speed': 0.3,         # é€Ÿåº¦å› å­æƒé‡
            'trajectory': 0.2,    # è½¨è¿¹å› å­æƒé‡
            'object_type': 0.1    # ç‰©ä½“ç±»å‹å› å­æƒé‡
        }
        self.risk_thresholds = {
            'L0': 0.2,  # æ— é£é™©
            'L1': 0.4,  # ä½é£é™©
            'L2': 0.6,  # ä¸­é£é™©
            'L3': 0.8   # é«˜é£é™©
        }
```

### é£é™©ç­‰çº§åˆ†ç±»
```python
class RiskLevel:
    L0_SAFE = 0         # å®‰å…¨ - æ— éœ€ç‰¹æ®Šå¤„ç†
    L1_CAUTION = 1      # æ³¨æ„ - æŒç»­ç›‘æ§
    L2_WARNING = 2      # è­¦å‘Š - å‡†å¤‡é¿éšœåŠ¨ä½œ
    L3_DANGER = 3       # å±é™© - ç«‹å³é¿éšœ
    L4_CRITICAL = 4     # æå±é™© - ç´§æ€¥åœæ­¢
```

### é£é™©è¯„ä¼°ç»´åº¦

#### 1. è·ç¦»é£é™©è¯„ä¼°
```python
def assess_distance_risk(self, distance, object_type):
    """åŸºäºè·ç¦»çš„é£é™©è¯„ä¼°"""
    safe_distances = {
        'person': 2.0,      # è¡Œäººå®‰å…¨è·ç¦»
        'car': 5.0,         # æ±½è½¦å®‰å…¨è·ç¦»
        'bicycle': 3.0,     # è‡ªè¡Œè½¦å®‰å…¨è·ç¦»
        'obstacle': 1.5     # é™æ€éšœç¢ç‰©å®‰å…¨è·ç¦»
    }
    
    safe_dist = safe_distances.get(object_type, 2.0)
    risk_score = max(0, 1 - distance / safe_dist)
    return min(risk_score, 1.0)
```

#### 2. é€Ÿåº¦é£é™©è¯„ä¼°
```python
def assess_speed_risk(self, speed, direction_angle):
    """åŸºäºé€Ÿåº¦å’Œæ–¹å‘çš„é£é™©è¯„ä¼°"""
    # è€ƒè™‘ç‰©ä½“é€Ÿåº¦å’Œè¿åŠ¨æ–¹å‘
    # æ­£é¢æ¥è¿‘çš„å¿«é€Ÿç‰©ä½“é£é™©æœ€é«˜
    approach_factor = math.cos(math.radians(direction_angle))
    speed_risk = min(speed / 10.0, 1.0)  # 10 km/hä¸ºåŸºå‡†
    return speed_risk * max(approach_factor, 0)
```

#### 3. è½¨è¿¹é£é™©è¯„ä¼°
```python
def assess_trajectory_risk(self, trajectory, user_path):
    """åŸºäºè½¨è¿¹äº¤å‰çš„é£é™©è¯„ä¼°"""
    # è®¡ç®—ç‰©ä½“è½¨è¿¹ä¸ç”¨æˆ·è·¯å¾„çš„äº¤å‰æ¦‚ç‡
    # é¢„æµ‹ç¢°æ’æ—¶é—´å’Œä½ç½®
    intersection_prob = self.calculate_intersection_probability(
        trajectory, user_path
    )
    return intersection_prob
```

## ğŸ§  å†³ç­–å¼•æ“

### DecisionEngineç±»
æ™ºèƒ½å†³ç­–å’Œç­–ç•¥é€‰æ‹©ï¼š

```python
class DecisionEngine:
    def __init__(self):
        self.decision_tree = self.build_decision_tree()
        self.action_history = []
        self.context_memory = {}
        
    def make_decision(self, risk_assessment, environment_context):
        """åŸºäºé£é™©è¯„ä¼°åšå‡ºå†³ç­–"""
        decision = self.evaluate_decision_tree(
            risk_assessment, environment_context
        )
        return decision
```

### å†³ç­–ç±»å‹
```python
class DecisionType:
    CONTINUE = "continue"           # ç»§ç»­å‰è¿›
    SLOW_DOWN = "slow_down"         # å‡é€Ÿå‰è¿›
    CHANGE_DIRECTION = "change_dir" # æ”¹å˜æ–¹å‘
    STOP = "stop"                   # åœæ­¢
    EMERGENCY_STOP = "emergency"    # ç´§æ€¥åœæ­¢
    WAIT = "wait"                   # ç­‰å¾…
    RETREAT = "retreat"             # åé€€
```

### å†³ç­–è§„åˆ™ç¤ºä¾‹
```python
DECISION_RULES = {
    'L0_SAFE': {
        'action': DecisionType.CONTINUE,
        'voice_prompt': None,
        'monitoring': False
    },
    'L1_CAUTION': {
        'action': DecisionType.CONTINUE,
        'voice_prompt': "å‰æ–¹æœ‰{object}ï¼Œæ³¨æ„è§‚å¯Ÿ",
        'monitoring': True
    },
    'L2_WARNING': {
        'action': DecisionType.SLOW_DOWN,
        'voice_prompt': "å‰æ–¹{distance}ç±³å¤„æœ‰{object}ï¼Œè¯·å‡é€Ÿ",
        'monitoring': True
    },
    'L3_DANGER': {
        'action': DecisionType.CHANGE_DIRECTION,
        'voice_prompt': "å±é™©ï¼å‰æ–¹æœ‰{object}ï¼Œå»ºè®®{direction}é¿å¼€",
        'monitoring': True
    }
}
```

## ğŸ¯ è¡ŒåŠ¨è§„åˆ’å™¨

### ActionPlannerç±»
å…·ä½“é¿éšœè¡ŒåŠ¨ç”Ÿæˆå’Œæ‰§è¡Œï¼š

```python
class ActionPlanner:
    def __init__(self):
        self.available_actions = self.init_action_set()
        self.action_constraints = {}
        self.execution_queue = []
        
    def plan_avoidance_action(self, decision, environment):
        """è§„åˆ’å…·ä½“çš„é¿éšœè¡ŒåŠ¨"""
        action_plan = self.generate_action_sequence(decision, environment)
        return action_plan
```

### é¿éšœåŠ¨ä½œç±»å‹

#### 1. æ–¹å‘è°ƒæ•´åŠ¨ä½œ
```python
class DirectionAction:
    def __init__(self, direction, angle, distance):
        self.direction = direction    # "left", "right", "back"
        self.angle = angle           # è°ƒæ•´è§’åº¦(åº¦)
        self.distance = distance     # ç§»åŠ¨è·ç¦»(ç±³)
        self.duration = None         # æ‰§è¡Œæ—¶é•¿
        
    def generate_voice_instruction(self):
        """ç”Ÿæˆè¯­éŸ³æŒ‡ä»¤"""
        return f"å‘{self.direction}ç§»åŠ¨{self.angle}åº¦ï¼Œå‰è¿›{self.distance}ç±³"
```

#### 2. é€Ÿåº¦è°ƒæ•´åŠ¨ä½œ
```python
class SpeedAction:
    def __init__(self, speed_factor, duration):
        self.speed_factor = speed_factor  # é€Ÿåº¦è°ƒæ•´å› å­ (0.0-1.0)
        self.duration = duration          # æŒç»­æ—¶é—´(ç§’)
        
    def generate_voice_instruction(self):
        if self.speed_factor < 0.5:
            return f"è¯·å‡é€Ÿæ…¢è¡Œï¼ŒæŒç»­{self.duration}ç§’"
        else:
            return "å¯ä»¥æ­£å¸¸å‰è¿›"
```

#### 3. ç­‰å¾…åŠ¨ä½œ
```python
class WaitAction:
    def __init__(self, wait_time, condition):
        self.wait_time = wait_time    # ç­‰å¾…æ—¶é—´(ç§’)
        self.condition = condition    # ç­‰å¾…æ¡ä»¶
        
    def generate_voice_instruction(self):
        return f"è¯·ç­‰å¾…{self.wait_time}ç§’ï¼Œç­‰{self.condition}é€šè¿‡"
```

## ğŸ“ ç‰©ä½“è¿½è¸ªç³»ç»Ÿ

### ObjectTrackerç±»
åŠ¨æ€ç‰©ä½“è½¨è¿¹è·Ÿè¸ªå’Œé¢„æµ‹ï¼š

```python
class ObjectTracker:
    def __init__(self):
        self.tracked_objects = {}     # è¿½è¸ªå¯¹è±¡å­—å…¸
        self.track_id_counter = 0     # è¿½è¸ªIDè®¡æ•°å™¨
        self.max_disappeared = 10     # æœ€å¤§æ¶ˆå¤±å¸§æ•°
        
    def update_tracks(self, detections, depth_map):
        """æ›´æ–°ç‰©ä½“è¿½è¸ª"""
        # å…³è”æ£€æµ‹ç»“æœä¸ç°æœ‰è½¨è¿¹
        # åˆ›å»ºæ–°è½¨è¿¹æˆ–æ›´æ–°ç°æœ‰è½¨è¿¹
        # åˆ é™¤é•¿æ—¶é—´æ¶ˆå¤±çš„è½¨è¿¹
```

### è½¨è¿¹é¢„æµ‹
```python
class TrajectoryPredictor:
    def __init__(self):
        self.prediction_horizon = 3.0  # é¢„æµ‹æ—¶é—´çª—å£(ç§’)
        self.min_track_length = 5      # æœ€å°è½¨è¿¹é•¿åº¦
        
    def predict_trajectory(self, track_history):
        """é¢„æµ‹ç‰©ä½“æœªæ¥è½¨è¿¹"""
        # åŸºäºå†å²ä½ç½®æ•°æ®
        # ä½¿ç”¨å¡å°”æ›¼æ»¤æ³¢æˆ–çº¿æ€§é¢„æµ‹
        # ç”Ÿæˆæœªæ¥ä½ç½®é¢„æµ‹
        
    def estimate_collision_risk(self, trajectory, user_path):
        """ä¼°ç®—ç¢°æ’é£é™©"""
        # è®¡ç®—è½¨è¿¹äº¤å‰ç‚¹
        # ä¼°ç®—åˆ°è¾¾æ—¶é—´å·®
        # è¯„ä¼°ç¢°æ’æ¦‚ç‡
```

## âš¡ é€Ÿåº¦æµ‹é‡ç³»ç»Ÿ

### SpeedMeasurementç±»
ç‰©ä½“è¿åŠ¨é€Ÿåº¦è®¡ç®—ï¼š

```python
class SpeedMeasurement:
    def __init__(self):
        self.position_history = {}    # ä½ç½®å†å²è®°å½•
        self.speed_history = {}       # é€Ÿåº¦å†å²è®°å½•
        self.smoothing_factor = 0.3   # é€Ÿåº¦å¹³æ»‘å› å­
        
    def calculate_speed(self, object_id, current_position, timestamp):
        """è®¡ç®—ç‰©ä½“é€Ÿåº¦"""
        if object_id in self.position_history:
            prev_pos, prev_time = self.position_history[object_id]
            
            # è®¡ç®—ä½ç§»å’Œæ—¶é—´å·®
            displacement = self.calculate_displacement(prev_pos, current_position)
            time_diff = timestamp - prev_time
            
            # è®¡ç®—ç¬æ—¶é€Ÿåº¦
            speed = displacement / time_diff if time_diff > 0 else 0
            
            # åº”ç”¨å¹³æ»‘æ»¤æ³¢
            smoothed_speed = self.apply_smoothing(object_id, speed)
            
            return smoothed_speed
```

### è¿åŠ¨åˆ†æ
```python
def analyze_motion_pattern(self, object_id):
    """åˆ†æç‰©ä½“è¿åŠ¨æ¨¡å¼"""
    if object_id not in self.speed_history:
        return "unknown"
        
    speeds = self.speed_history[object_id]
    
    # åˆ†æè¿åŠ¨æ¨¡å¼
    if all(s < 0.5 for s in speeds[-5:]):
        return "stationary"      # é™æ­¢
    elif self.is_accelerating(speeds):
        return "accelerating"    # åŠ é€Ÿ
    elif self.is_decelerating(speeds):
        return "decelerating"    # å‡é€Ÿ
    else:
        return "constant"        # åŒ€é€Ÿ
```

## âš™ï¸ é…ç½®å‚æ•°

### é£é™©è¯„ä¼°é…ç½®
```python
RISK_CONFIG = {
    'distance_weights': {
        'person': 2.0,
        'car': 5.0,
        'bicycle': 3.0,
        'motorcycle': 4.0,
        'obstacle': 1.5
    },
    'speed_threshold': 5.0,          # é€Ÿåº¦é£é™©é˜ˆå€¼(km/h)
    'trajectory_lookahead': 3.0,     # è½¨è¿¹é¢„æµ‹æ—¶é—´(ç§’)
    'risk_decay_rate': 0.1,          # é£é™©è¡°å‡ç‡
    'multi_object_penalty': 1.2      # å¤šç‰©ä½“é£é™©æƒ©ç½šå› å­
}
```

### å†³ç­–å¼•æ“é…ç½®
```python
DECISION_CONFIG = {
    'reaction_time': 0.5,            # ååº”æ—¶é—´(ç§’)
    'decision_confidence': 0.8,      # å†³ç­–ç½®ä¿¡åº¦é˜ˆå€¼
    'action_timeout': 10.0,          # åŠ¨ä½œè¶…æ—¶æ—¶é—´(ç§’)
    'emergency_override': True,      # ç´§æ€¥æƒ…å†µè¦†ç›–
    'voice_feedback_delay': 1.0      # è¯­éŸ³åé¦ˆå»¶è¿Ÿ(ç§’)
}
```

### è¿½è¸ªç³»ç»Ÿé…ç½®
```python
TRACKING_CONFIG = {
    'max_disappeared_frames': 10,    # æœ€å¤§æ¶ˆå¤±å¸§æ•°
    'track_association_threshold': 0.3, # è½¨è¿¹å…³è”é˜ˆå€¼
    'min_track_confidence': 0.7,     # æœ€å°è½¨è¿¹ç½®ä¿¡åº¦
    'prediction_horizon': 3.0,       # é¢„æµ‹æ—¶é—´çª—å£(ç§’)
    'kalman_filter_noise': 0.1       # å¡å°”æ›¼æ»¤æ³¢å™ªå£°
}
```

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬é¿éšœä½¿ç”¨
```python
from core.risk_assessor import RiskAssessor
from core.decision_engine import DecisionEngine
from core.action_planner import ActionPlanner

# åˆå§‹åŒ–é¿éšœç³»ç»Ÿ
risk_assessor = RiskAssessor()
decision_engine = DecisionEngine()
action_planner = ActionPlanner()

# å¤„ç†æ£€æµ‹ç»“æœ
def process_detections(detections, depth_map):
    # é£é™©è¯„ä¼°
    risks = risk_assessor.assess_multiple_risks(detections, depth_map)
    
    # å†³ç­–åˆ¶å®š
    decision = decision_engine.make_decision(risks, environment_context)
    
    # è¡ŒåŠ¨è§„åˆ’
    action_plan = action_planner.plan_avoidance_action(decision, environment)
    
    return action_plan
```

### å®æ—¶é¿éšœé›†æˆ
```python
class RealtimeObstacleAvoidance:
    def __init__(self):
        self.risk_assessor = RiskAssessor()
        self.decision_engine = DecisionEngine()
        self.action_planner = ActionPlanner()
        self.object_tracker = ObjectTracker()
        
    def process_frame(self, frame, detections, depth_map):
        # æ›´æ–°ç‰©ä½“è¿½è¸ª
        self.object_tracker.update_tracks(detections, depth_map)
        
        # è¯„ä¼°å½“å‰é£é™©
        current_risks = self.assess_frame_risks(detections, depth_map)
        
        # åˆ¶å®šé¿éšœå†³ç­–
        if max(current_risks.values()) >= RiskLevel.L2_WARNING:
            decision = self.decision_engine.make_decision(current_risks)
            action = self.action_planner.plan_avoidance_action(decision)
            
            # æ‰§è¡Œé¿éšœåŠ¨ä½œ
            self.execute_avoidance_action(action)
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é¿éšœååº”è¿‡äºæ•æ„Ÿ
```
åŸå› : é£é™©é˜ˆå€¼è®¾ç½®è¿‡ä½
è§£å†³:
- è°ƒæ•´é£é™©è¯„ä¼°é˜ˆå€¼
- å¢åŠ å†³ç­–ç½®ä¿¡åº¦è¦æ±‚
- ä¼˜åŒ–å¤šç‰©ä½“é£é™©è®¡ç®—
```

#### 2. ç‰©ä½“è¿½è¸ªä¸¢å¤±
```
åŸå› : è¿½è¸ªå‚æ•°ä¸å½“æˆ–é®æŒ¡ä¸¥é‡
è§£å†³:
- è°ƒæ•´è¿½è¸ªå…³è”é˜ˆå€¼
- å¢åŠ æœ€å¤§æ¶ˆå¤±å¸§æ•°
- ä¼˜åŒ–è½¨è¿¹é¢„æµ‹ç®—æ³•
```

#### 3. é¿éšœæŒ‡ä»¤å†²çª
```
åŸå› : å¤šä¸ªé£é™©æºäº§ç”ŸçŸ›ç›¾æŒ‡ä»¤
è§£å†³:
- å®ç°å†³ç­–ä¼˜å…ˆçº§æœºåˆ¶
- æ·»åŠ æŒ‡ä»¤å†²çªæ£€æµ‹
- ä¼˜åŒ–å¤šç›®æ ‡é¿éšœç­–ç•¥
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### é£é™©è¯„ä¼°æ€§èƒ½
- **è¯„ä¼°å»¶è¿Ÿ**: < 10ms
- **å‡†ç¡®ç‡**: > 92%
- **è¯¯æŠ¥ç‡**: < 8%
- **å¤šç‰©ä½“å¤„ç†**: æ”¯æŒåŒæ—¶å¤„ç†20+ç‰©ä½“

### å†³ç­–å“åº”æ€§èƒ½
- **å†³ç­–å»¶è¿Ÿ**: < 50ms
- **ç´§æ€¥å“åº”**: < 100ms
- **å†³ç­–å‡†ç¡®ç‡**: > 88%
- **åŠ¨ä½œæ‰§è¡ŒæˆåŠŸç‡**: > 95%

### è¿½è¸ªç³»ç»Ÿæ€§èƒ½
- **è¿½è¸ªç²¾åº¦**: > 90%
- **è½¨è¿¹é¢„æµ‹å‡†ç¡®ç‡**: > 85%
- **å¤šç›®æ ‡è¿½è¸ª**: æ”¯æŒ20ä¸ªå¹¶å‘ç›®æ ‡
- **è¿½è¸ªç¨³å®šæ€§**: > 95%

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.3 (å½“å‰ç‰ˆæœ¬)
- âœ… å®ç°L0-L3åˆ†å±‚é£é™©è¯„ä¼°ç³»ç»Ÿ
- âœ… æ·»åŠ æ™ºèƒ½å†³ç­–å¼•æ“å’Œè¡ŒåŠ¨è§„åˆ’å™¨
- âœ… é›†æˆç‰©ä½“è¿½è¸ªå’Œè½¨è¿¹é¢„æµ‹
- âœ… ä¼˜åŒ–å¤šç‰©ä½“é¿éšœç­–ç•¥

### v1.2
- âœ… åŸºç¡€é£é™©è¯„ä¼°åŠŸèƒ½
- âœ… ç®€å•é¿éšœå†³ç­–é€»è¾‘
- âœ… ç‰©ä½“é€Ÿåº¦æµ‹é‡

### v1.1
- âœ… åŸºç¡€éšœç¢ç‰©æ£€æµ‹
- âœ… è·ç¦»å®‰å…¨è¯„ä¼°
- âœ… ç®€å•è¯­éŸ³è­¦å‘Š

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [æ·±åº¦ä¼°è®¡æ¨¡å—æ–‡æ¡£](./æ·±åº¦ä¼°è®¡æ¨¡å—.md)
- [æ£€æµ‹æ¨¡å—æ–‡æ¡£](./æ£€æµ‹æ¨¡å—.md)
- [è¯­éŸ³æ¨¡å—æ–‡æ¡£](./è¯­éŸ³æ¨¡å—.md)
- [å†³ç­–æ¡†æ¶æ–‡æ¡£](./DECISION_CONTEXT.md)
