# BlindStar å¯¼èˆªæ¨¡å—æ–‡æ¡£

## ğŸ“– æ¨¡å—æ¦‚è¿°

BlindStarå¯¼èˆªæ¨¡å—æä¾›æ™ºèƒ½å¯¼èˆªå’Œä½ç½®æœåŠ¡åŠŸèƒ½ï¼Œé›†æˆé«˜å¾·åœ°å›¾APIï¼Œä¸ºè§†éšœç”¨æˆ·æä¾›ç²¾ç¡®çš„POIæŸ¥è¯¢ã€è·¯å¾„è§„åˆ’å’Œå®æ—¶å¯¼èˆªæŒ‡å¼•ã€‚æ”¯æŒè¯­éŸ³äº¤äº’å’Œå¤šç§å¯¼èˆªæ¨¡å¼ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶
- **å¯¼èˆªä¸Šä¸‹æ–‡ç®¡ç†å™¨** (`core/navigation_context.py`): å¯¼èˆªçŠ¶æ€å’Œä¸Šä¸‹æ–‡ç®¡ç†
- **é«˜å¾·åœ°å›¾é›†æˆ** (`core/amap_navigation.py`): åœ°å›¾APIæ¥å£å’Œå¯¼èˆªæœåŠ¡
- **POIæŸ¥è¯¢æœåŠ¡** (`core/poi_query.py`): å…´è¶£ç‚¹æœç´¢å’Œä¿¡æ¯è·å–
- **è¯­éŸ³å¯¼èˆªäº¤äº’**: ä¸è¯­éŸ³æ¨¡å—é›†æˆçš„å¯¼èˆªå‘½ä»¤å¤„ç†

### æŠ€æœ¯æ ˆ
- **é«˜å¾·åœ°å›¾API**: æä¾›åœ°ç†ä¿¡æ¯æœåŠ¡ã€POIæœç´¢ã€è·¯å¾„è§„åˆ’
- **GPSå®šä½**: å®æ—¶ä½ç½®è·å–å’Œè½¨è¿¹è·Ÿè¸ª
- **è¯­éŸ³äº¤äº’**: æ”¯æŒè‡ªç„¶è¯­è¨€å¯¼èˆªå‘½ä»¤
- **ç¦»çº¿ç¼“å­˜**: å…³é”®å¯¼èˆªæ•°æ®æœ¬åœ°ç¼“å­˜

## ğŸ—ºï¸ å¯¼èˆªä¸Šä¸‹æ–‡ç®¡ç†

### NavigationContextManagerç±»
è´Ÿè´£ç®¡ç†å¯¼èˆªçŠ¶æ€ã€GPSä½ç½®å’Œè·¯å¾„è·Ÿè¸ªï¼š

```python
class NavigationContextManager:
    def __init__(self):
        self.current_location = None      # å½“å‰GPSä½ç½®
        self.destination = None           # ç›®æ ‡ä½ç½®
        self.navigation_mode = "assist"   # å¯¼èˆªæ¨¡å¼
        self.route_points = []           # è·¯å¾„ç‚¹åˆ—è¡¨
        self.current_instruction = None   # å½“å‰å¯¼èˆªæŒ‡ä»¤
```

### å¯¼èˆªæ¨¡å¼
- **assist**: è¾…åŠ©æ¨¡å¼ - åŸºç¡€ä½ç½®å’Œæ–¹å‘ä¿¡æ¯
- **guide**: å¼•å¯¼æ¨¡å¼ - è¯¦ç»†è·¯å¾„æŒ‡å¼•å’Œè½¬å‘æç¤º
- **full**: å®Œæ•´æ¨¡å¼ - å…¨åŠŸèƒ½å¯¼èˆªåŒ…æ‹¬å®æ—¶äº¤é€šä¿¡æ¯

### GPSä½ç½®å¤„ç†
```python
class GPSLocation:
    def __init__(self, latitude, longitude, accuracy=None):
        self.latitude = latitude          # çº¬åº¦
        self.longitude = longitude        # ç»åº¦
        self.accuracy = accuracy          # å®šä½ç²¾åº¦(ç±³)
        self.timestamp = time.time()      # æ—¶é—´æˆ³
        
    def distance_to(self, other_location):
        """è®¡ç®—åˆ°å¦ä¸€ä½ç½®çš„è·ç¦»(ç±³)"""
        
    def bearing_to(self, other_location):
        """è®¡ç®—åˆ°å¦ä¸€ä½ç½®çš„æ–¹ä½è§’(åº¦)"""
```

## ğŸ” POIæŸ¥è¯¢æœåŠ¡

### æ”¯æŒçš„POIç±»å‹
```python
POI_CATEGORIES = {
    'é¤å…': ['é¤å…', 'é¥­åº—', 'é£Ÿå ‚', 'å¿«é¤'],
    'å’–å•¡å…': ['å’–å•¡å…', 'å’–å•¡åº—', 'èŒ¶é¦†'],
    'è¶…å¸‚': ['è¶…å¸‚', 'ä¾¿åˆ©åº—', 'å•†åº—'],
    'é“¶è¡Œ': ['é“¶è¡Œ', 'ATM', 'å–æ¬¾æœº'],
    'åŒ»é™¢': ['åŒ»é™¢', 'è¯Šæ‰€', 'è¯åº—'],
    'äº¤é€š': ['åœ°é“ç«™', 'å…¬äº¤ç«™', 'ç«è½¦ç«™', 'æœºåœº'],
    'è´­ç‰©': ['å•†åœº', 'ç™¾è´§', 'ä¸“å–åº—'],
    'æœåŠ¡': ['é‚®å±€', 'åŠ æ²¹ç«™', 'åœè½¦åœº']
}
```

### POIæŸ¥è¯¢åŠŸèƒ½
```python
class POIQuery:
    def search_nearby_pois(self, location, category, radius=1000):
        """æœç´¢é™„è¿‘POI"""
        
    def get_poi_details(self, poi_id):
        """è·å–POIè¯¦ç»†ä¿¡æ¯"""
        
    def search_by_keyword(self, keyword, location, radius=1000):
        """å…³é”®è¯æœç´¢POI"""
```

### æŸ¥è¯¢ç»“æœæ ¼å¼
```python
class POIResult:
    def __init__(self):
        self.name = ""              # POIåç§°
        self.address = ""           # è¯¦ç»†åœ°å€
        self.distance = 0           # è·ç¦»(ç±³)
        self.bearing = 0            # æ–¹ä½è§’(åº¦)
        self.category = ""          # POIç±»åˆ«
        self.phone = ""             # è”ç³»ç”µè¯
        self.rating = 0.0           # è¯„åˆ†
        self.location = None        # GPSåæ ‡
```

## ğŸ§­ è·¯å¾„è§„åˆ’ä¸å¯¼èˆª

### è·¯å¾„è§„åˆ’
```python
class RoutePlanner:
    def plan_route(self, start_location, end_location, mode="walking"):
        """è§„åˆ’è·¯å¾„"""
        # mode: "walking", "transit", "driving"
        
    def get_route_instructions(self, route):
        """è·å–è¯¦ç»†å¯¼èˆªæŒ‡ä»¤"""
        
    def calculate_eta(self, route):
        """è®¡ç®—é¢„è®¡åˆ°è¾¾æ—¶é—´"""
```

### å¯¼èˆªæŒ‡ä»¤ç±»å‹
```python
class NavigationInstruction:
    STRAIGHT = "ç›´è¡Œ"
    LEFT = "å·¦è½¬"
    RIGHT = "å³è½¬"
    U_TURN = "æ‰å¤´"
    ARRIVE = "åˆ°è¾¾ç›®çš„åœ°"
    
    def __init__(self, action, distance, description):
        self.action = action          # åŠ¨ä½œç±»å‹
        self.distance = distance      # è·ç¦»(ç±³)
        self.description = description # è¯¦ç»†æè¿°
```

### å®æ—¶å¯¼èˆª
```python
class RealTimeNavigation:
    def start_navigation(self, destination):
        """å¼€å§‹å¯¼èˆª"""
        
    def update_location(self, current_location):
        """æ›´æ–°å½“å‰ä½ç½®"""
        
    def get_next_instruction(self):
        """è·å–ä¸‹ä¸€ä¸ªå¯¼èˆªæŒ‡ä»¤"""
        
    def check_route_deviation(self):
        """æ£€æŸ¥æ˜¯å¦åç¦»è·¯çº¿"""
```

## ğŸ¯ è¯­éŸ³å¯¼èˆªäº¤äº’

### æ”¯æŒçš„è¯­éŸ³å‘½ä»¤

#### ç›®çš„åœ°è®¾ç½®
```
- "å¯¼èˆªåˆ°å¤©å®‰é—¨"
- "å»åŒ—äº¬å¤§å­¦"
- "å¯¼èˆªå»æœ€è¿‘çš„è¶…å¸‚"
- "å¸¦æˆ‘å»å’–å•¡å…"
```

#### å¯¼èˆªæ§åˆ¶
```
- "å¼€å§‹å¯¼èˆª"
- "æš‚åœå¯¼èˆª"
- "ç»§ç»­å¯¼èˆª"
- "ç»“æŸå¯¼èˆª"
- "é‡æ–°è§„åˆ’è·¯çº¿"
```

#### ä¿¡æ¯æŸ¥è¯¢
```
- "å½“å‰ä½ç½®"
- "å‰©ä½™è·ç¦»"
- "é¢„è®¡åˆ°è¾¾æ—¶é—´"
- "ä¸‹ä¸€ä¸ªè½¬å¼¯"
- "é™„è¿‘æœ‰ä»€ä¹ˆ"
```

#### POIæœç´¢
```
- "é™„è¿‘æœ‰ä»€ä¹ˆé¤å…"
- "æŸ¥æ‰¾æœ€è¿‘çš„é“¶è¡Œ"
- "æ‰¾å’–å•¡å…"
- "æœç´¢åŠ æ²¹ç«™"
```

### è¯­éŸ³åé¦ˆç¤ºä¾‹
```python
NAVIGATION_RESPONSES = {
    'route_planned': "è·¯çº¿è§„åˆ’å®Œæˆï¼Œæ€»è·ç¦»{distance}ç±³ï¼Œé¢„è®¡{time}åˆ†é’Ÿåˆ°è¾¾",
    'navigation_started': "å¼€å§‹å¯¼èˆªåˆ°{destination}",
    'next_instruction': "å‰æ–¹{distance}ç±³å{action}",
    'arrived': "å·²åˆ°è¾¾ç›®çš„åœ°{destination}",
    'poi_found': "æ‰¾åˆ°{count}ä¸ª{category}ï¼Œæœ€è¿‘çš„è·ç¦»{distance}ç±³",
    'location_update': "å½“å‰ä½ç½®ï¼š{address}ï¼Œè·ç¦»ç›®çš„åœ°è¿˜æœ‰{distance}ç±³"
}
```

## âš™ï¸ é…ç½®å‚æ•°

### é«˜å¾·åœ°å›¾APIé…ç½®
```python
class AmapConfig:
    def __init__(self):
        self.api_key = ""                    # APIå¯†é’¥
        self.base_url = "https://restapi.amap.com"
        self.poi_search_radius = 1000        # POIæœç´¢åŠå¾„(ç±³)
        self.max_poi_results = 10            # æœ€å¤§POIç»“æœæ•°
        self.route_planning_mode = "walking" # è·¯å¾„è§„åˆ’æ¨¡å¼
        self.enable_traffic = True           # å¯ç”¨å®æ—¶äº¤é€š
```

### å¯¼èˆªå‚æ•°
```python
NAVIGATION_CONFIG = {
    'update_interval': 5.0,          # ä½ç½®æ›´æ–°é—´éš”(ç§’)
    'route_deviation_threshold': 50, # è·¯çº¿åç¦»é˜ˆå€¼(ç±³)
    'instruction_distance': 100,     # æå‰æ’­æŠ¥è·ç¦»(ç±³)
    'poi_search_radius': 1000,       # POIæœç´¢åŠå¾„(ç±³)
    'cache_expire_time': 3600,       # ç¼“å­˜è¿‡æœŸæ—¶é—´(ç§’)
    'voice_navigation': True,        # å¯ç”¨è¯­éŸ³å¯¼èˆª
    'auto_reroute': True            # è‡ªåŠ¨é‡æ–°è§„åˆ’è·¯çº¿
}
```

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å¯¼èˆªä½¿ç”¨
```python
from core.navigation_context import NavigationContextManager
from core.amap_navigation import AmapNavigation

# åˆå§‹åŒ–å¯¼èˆªç³»ç»Ÿ
nav_manager = NavigationContextManager()
amap_nav = AmapNavigation()

# è®¾ç½®å½“å‰ä½ç½®
current_pos = GPSLocation(39.9042, 116.4074)  # å¤©å®‰é—¨åæ ‡
nav_manager.set_current_location(current_pos)

# æœç´¢POI
pois = amap_nav.search_nearby_pois(current_pos, "é¤å…", radius=500)
print(f"æ‰¾åˆ°{len(pois)}ä¸ªé¤å…")

# å¼€å§‹å¯¼èˆª
destination = pois[0].location
nav_manager.start_navigation(destination)
```

### è¯­éŸ³å¯¼èˆªé›†æˆ
```python
class VoiceNavigationHandler:
    def __init__(self, nav_manager, tts_engine):
        self.nav_manager = nav_manager
        self.tts = tts_engine
        
    def handle_navigation_command(self, command):
        if "å¯¼èˆªåˆ°" in command:
            destination_name = self.extract_destination(command)
            self.start_navigation_to(destination_name)
        elif "é™„è¿‘" in command and any(poi in command for poi in POI_CATEGORIES):
            category = self.extract_poi_category(command)
            self.search_nearby_pois(category)
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. GPSå®šä½å¤±è´¥
```
åŸå› : GPSä¿¡å·å¼±æˆ–å®šä½æƒé™é—®é¢˜
è§£å†³: 
- ç¡®ä¿åœ¨å¼€é˜”åŒºåŸŸä½¿ç”¨
- æ£€æŸ¥åº”ç”¨å®šä½æƒé™
- ç­‰å¾…GPSä¿¡å·ç¨³å®š
```

#### 2. é«˜å¾·åœ°å›¾APIè°ƒç”¨å¤±è´¥
```
åŸå› : APIå¯†é’¥æ— æ•ˆæˆ–ç½‘ç»œé—®é¢˜
è§£å†³:
- æ£€æŸ¥APIå¯†é’¥é…ç½®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- æ£€æŸ¥APIè°ƒç”¨é¢‘ç‡é™åˆ¶
```

#### 3. è·¯å¾„è§„åˆ’å¤±è´¥
```
åŸå› : èµ·ç‚¹ç»ˆç‚¹æ— æ•ˆæˆ–æ— å¯è¾¾è·¯å¾„
è§£å†³:
- ç¡®è®¤èµ·ç‚¹ç»ˆç‚¹åæ ‡æ­£ç¡®
- é€‰æ‹©åˆé€‚çš„å‡ºè¡Œæ–¹å¼
- æ£€æŸ¥ç›®çš„åœ°æ˜¯å¦å¯è¾¾
```

### è°ƒè¯•å‘½ä»¤
```bash
# æµ‹è¯•GPSå®šä½
python -c "from core.navigation_context import *; test_gps_location()"

# æµ‹è¯•POIæŸ¥è¯¢
python -m core.poi_query --test

# æµ‹è¯•å¯¼èˆªåŠŸèƒ½
python -m core.amap_navigation --test-navigation
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å®šä½ç²¾åº¦
- **GPSç²¾åº¦**: é€šå¸¸ < 10ç±³
- **æ›´æ–°é¢‘ç‡**: 1-5ç§’é—´éš”
- **å†·å¯åŠ¨æ—¶é—´**: < 30ç§’

### APIå“åº”æ€§èƒ½
- **POIæŸ¥è¯¢**: < 2ç§’
- **è·¯å¾„è§„åˆ’**: < 3ç§’
- **å®æ—¶å¯¼èˆª**: < 1ç§’æ›´æ–°

### åŠŸèƒ½è¦†ç›–
- **POIç±»åˆ«**: æ”¯æŒ8å¤§ç±»ï¼Œ50+å­ç±»åˆ«
- **å¯¼èˆªæ¨¡å¼**: æ­¥è¡Œã€å…¬äº¤ã€é©¾è½¦
- **è¯­éŸ³å‘½ä»¤**: æ”¯æŒ20+ç§å¯¼èˆªç›¸å…³å‘½ä»¤

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.3 (å½“å‰ç‰ˆæœ¬)
- âœ… å®ç°NavigationContextManagerå¯¼èˆªä¸Šä¸‹æ–‡ç®¡ç†
- âœ… æ·»åŠ ä¸‰ç§å¯¼èˆªæ¨¡å¼æ”¯æŒ
- âœ… ä¼˜åŒ–POIæœç´¢å’Œåˆ†ç±»
- âœ… é›†æˆè¯­éŸ³å¯¼èˆªäº¤äº’

### v1.2
- âœ… é›†æˆé«˜å¾·åœ°å›¾API
- âœ… å®ç°åŸºç¡€POIæŸ¥è¯¢åŠŸèƒ½
- âœ… æ·»åŠ è·¯å¾„è§„åˆ’èƒ½åŠ›

### v1.1
- âœ… GPSå®šä½åŠŸèƒ½å®ç°
- âœ… åŸºç¡€å¯¼èˆªæ¡†æ¶æ­å»º
- âœ… ä½ç½®ä¿¡æ¯è¯­éŸ³æ’­æŠ¥

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [è¯­éŸ³æ¨¡å—æ–‡æ¡£](./è¯­éŸ³æ¨¡å—.md)
- [æ£€æµ‹æ¨¡å—æ–‡æ¡£](./æ£€æµ‹æ¨¡å—.md)
- [NAVIGATION_INTEGRATION.md](./NAVIGATION_INTEGRATION.md)
- [ç³»ç»Ÿé…ç½®æ–‡æ¡£](./configuration.md)
